generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AuthMethod {
  PHONE
  GOOGLE
  KAKAO
}

enum AccountStatus {
  ACTIVE
  SUSPENDED
  DELETED
}

enum ProfileType {
  ARTIST
  VENUE
  CREATOR
}

enum BlockType {
  LINK_BUTTON
  SOCIAL_ROW
  EMBED
  TEXT_ANNOUNCEMENT
  MEDIA_GALLERY
  EVENTS
  PLACE_INFO
  TICKET_CTA
  PRODUCT_CARDS
}

model UserAccount {
  id                String        @id @default(uuid())
  primaryAuthMethod AuthMethod    @map("primary_auth_method")
  phoneE164         String?       @unique @map("phone_e164")
  status            AccountStatus @default(ACTIVE)
  createdAt         DateTime      @default(now()) @map("created_at")
  lastLoginAt       DateTime?     @map("last_login_at")

  identities Identity[]
  profiles   Profile[]

  @@map("user_accounts")
}

model Identity {
  id             String     @id @default(uuid())
  userAccountId  String     @map("user_account_id")
  method         AuthMethod
  providerUserId String     @map("provider_user_id")
  verifiedAt     DateTime?  @map("verified_at")
  createdAt      DateTime   @default(now()) @map("created_at")

  userAccount UserAccount @relation(fields: [userAccountId], references: [id], onDelete: Cascade)

  @@unique([method, providerUserId])
  @@map("identities")
}

model Profile {
  id                        String      @id @default(uuid())
  ownerAccountId            String      @map("owner_account_id")
  handle                    String      @unique
  displayName               String      @map("display_name")
  type                      ProfileType
  bio                       String?
  avatarUrl                 String?     @map("avatar_url")
  coverUrl                  String?     @map("cover_url")
  location                  String?
  themeId                   String?     @map("theme_id")
  socialVerification        String?     @map("social_verification")
  connectedTrappistArtistId String?     @map("connected_trappist_artist_id")
  connectedTrappistPlaceId  String?     @map("connected_trappist_place_id")
  isPublished               Boolean     @default(false) @map("is_published")
  createdAt                 DateTime    @default(now()) @map("created_at")
  updatedAt                 DateTime    @updatedAt @map("updated_at")

  owner  UserAccount @relation(fields: [ownerAccountId], references: [id], onDelete: Cascade)
  blocks Block[]

  @@index([type])
  @@map("profiles")
}

model Block {
  id         String    @id @default(uuid())
  profileId  String    @map("profile_id")
  type       BlockType
  title      String?
  configJson Json      @map("config_json")
  sortOrder  Int       @default(0) @map("sort_order")
  isEnabled  Boolean   @default(true) @map("is_enabled")
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")

  profile Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId, sortOrder])
  @@map("blocks")
}
